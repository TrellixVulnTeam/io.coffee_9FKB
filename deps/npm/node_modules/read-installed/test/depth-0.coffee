readInstalled = require("../read-installed.js")
test = require("tap").test
json = require("../package.json")
path = require("path")
known = [].concat(Object.keys(json.dependencies), Object.keys(json.optionalDependencies), Object.keys(json.devDependencies)).sort()
test "make sure that it works with depth=0", (t) ->
  readInstalled path.join(__dirname, "../"),
    depth: 0
  , (er, map) ->
    t.notOk er, "er should be bull"
    t.ok map, "map should be data"
    return console.error(er.stack or er.message)  if er
    
    # Exclude self from dependencies when depth = 0
    delete map.dependencies[json.name]

    subdeps = Object.keys(map.dependencies).reduce((acc, dep) ->
      
      # Exclude self from dependencies when depth = current depth
      delete map.dependencies[dep].dependencies[dep]

      acc += Object.keys(map.dependencies[dep].dependencies).length
      acc
    , 0)
    t.equal subdeps, 0, "there should be no sub dependencies"
    t.end()
    return

  return

