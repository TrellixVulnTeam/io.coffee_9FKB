# Load modules

# Declare internals
internals = delimiter: "&"
internals.stringify = (obj, prefix) ->
  if Buffer.isBuffer(obj)
    obj = obj.toString()
  else if obj instanceof Date
    obj = obj.toISOString()
  else obj = ""  if obj is null
  return [encodeURIComponent(prefix) + "=" + encodeURIComponent(obj)]  if typeof obj is "string" or typeof obj is "number" or typeof obj is "boolean"
  values = []
  for key of obj
    values = values.concat(internals.stringify(obj[key], prefix + "[" + key + "]"))  if obj.hasOwnProperty(key)
  values

module.exports = (obj, delimiter) ->
  delimiter = (if typeof delimiter is "undefined" then internals.delimiter else delimiter)
  keys = []
  for key of obj
    keys = keys.concat(internals.stringify(obj[key], key))  if obj.hasOwnProperty(key)
  keys.join delimiter
