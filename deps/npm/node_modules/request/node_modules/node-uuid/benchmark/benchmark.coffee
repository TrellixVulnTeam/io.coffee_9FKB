rate = (msg, t) ->
  console.log msg + ": " + (N / (Date.now() - t) * 1e3 | 0) + " uuids/second"
  return
try
  nodeuuid = require("../uuid")
catch e
  console.error "node-uuid require failed - skipping tests"
try
  uuid = require("uuid")
catch e
  console.error "uuid require failed - skipping tests"
try
  uuidjs = require("uuid-js")
catch e
  console.error "uuid-js require failed - skipping tests"
N = 5e5
console.log "# v4"

# node-uuid - string form
if nodeuuid
  i = 0
  t = Date.now()

  while i < N
    nodeuuid.v4()
    i++
  rate "nodeuuid.v4() - using node.js crypto RNG", t
  i = 0
  t = Date.now()

  while i < N
    nodeuuid.v4 rng: nodeuuid.mathRNG
    i++
  rate "nodeuuid.v4() - using Math.random() RNG", t
  i = 0
  t = Date.now()

  while i < N
    nodeuuid.v4 "binary"
    i++
  rate "nodeuuid.v4('binary')", t
  buffer = new nodeuuid.BufferClass(16)
  i = 0
  t = Date.now()

  while i < N
    nodeuuid.v4 "binary", buffer
    i++
  rate "nodeuuid.v4('binary', buffer)", t

# libuuid - string form
if uuid
  i = 0
  t = Date.now()

  while i < N
    uuid()
    i++
  rate "uuid()", t
  i = 0
  t = Date.now()

  while i < N
    uuid "binary"
    i++
  rate "uuid('binary')", t

# uuid-js - string form
if uuidjs
  i = 0
  t = Date.now()

  while i < N
    uuidjs.create 4
    i++
  rate "uuidjs.create(4)", t

# 140byte.es
i = 0
t = Date.now()

while i < N
  "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace /[xy]/g, (s, r) ->
    r = Math.random() * 16 | 0
    ((if s is "x" then r else r & 0x3 | 0x8)).toString 16

  i++
rate "140byte.es_v4", t
console.log ""
console.log "# v1"

# node-uuid - v1 string form
if nodeuuid
  i = 0
  t = Date.now()

  while i < N
    nodeuuid.v1()
    i++
  rate "nodeuuid.v1()", t
  i = 0
  t = Date.now()

  while i < N
    nodeuuid.v1 "binary"
    i++
  rate "nodeuuid.v1('binary')", t
  buffer = new nodeuuid.BufferClass(16)
  i = 0
  t = Date.now()

  while i < N
    nodeuuid.v1 "binary", buffer
    i++
  rate "nodeuuid.v1('binary', buffer)", t

# uuid-js - v1 string form
if uuidjs
  i = 0
  t = Date.now()

  while i < N
    uuidjs.create 1
    i++
  rate "uuidjs.create(1)", t
