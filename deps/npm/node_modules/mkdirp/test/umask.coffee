mkdirp = require("../")
path = require("path")
fs = require("fs")
exists = fs.exists or path.exists
test = require("tap").test
test "implicit mode from umask", (t) ->
  t.plan 5
  x = Math.floor(Math.random() * Math.pow(16, 4)).toString(16)
  y = Math.floor(Math.random() * Math.pow(16, 4)).toString(16)
  z = Math.floor(Math.random() * Math.pow(16, 4)).toString(16)
  file = "/tmp/" + [
    x
    y
    z
  ].join("/")
  mkdirp file, (err) ->
    t.ifError err
    exists file, (ex) ->
      t.ok ex, "file created"
      fs.stat file, (err, stat) ->
        t.ifError err
        t.equal stat.mode & 0777, 0777 & (~process.umask())
        t.ok stat.isDirectory(), "target not a directory"
        return

      return

    return

  return

