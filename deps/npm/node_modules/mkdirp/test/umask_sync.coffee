mkdirp = require("../")
path = require("path")
fs = require("fs")
exists = fs.exists or path.exists
test = require("tap").test
test "umask sync modes", (t) ->
  t.plan 4
  x = Math.floor(Math.random() * Math.pow(16, 4)).toString(16)
  y = Math.floor(Math.random() * Math.pow(16, 4)).toString(16)
  z = Math.floor(Math.random() * Math.pow(16, 4)).toString(16)
  file = "/tmp/" + [
    x
    y
    z
  ].join("/")
  try
    mkdirp.sync file
  catch err
    t.fail err
    return t.end()
  exists file, (ex) ->
    t.ok ex, "file created"
    fs.stat file, (err, stat) ->
      t.ifError err
      t.equal stat.mode & 0777, (0777 & (~process.umask()))
      t.ok stat.isDirectory(), "target not a directory"
      return

    return

  return

