mkdirp = require("../")
path = require("path")
fs = require("fs")
exists = fs.exists or path.exists
test = require("tap").test
test "async perm", (t) ->
  t.plan 5
  file = "/tmp/" + (Math.random() * (1 << 30)).toString(16)
  mkdirp file, 0755, (err) ->
    t.ifError err
    exists file, (ex) ->
      t.ok ex, "file created"
      fs.stat file, (err, stat) ->
        t.ifError err
        t.equal stat.mode & 0777, 0755
        t.ok stat.isDirectory(), "target not a directory"
        return

      return

    return

  return

test "async root perm", (t) ->
  mkdirp "/tmp", 0755, (err) ->
    t.fail err  if err
    t.end()
    return

  t.end()
  return

