glob = require("../")
test = require("tap").test
path = require("path")
test "stat all the things", (t) ->
  g = new glob.Glob("a/*abc*/**",
    stat: true
    cwd: __dirname
  )
  matches = []
  g.on "match", (m) ->
    matches.push m
    return

  stats = []
  g.on "stat", (m) ->
    stats.push m
    return

  g.on "end", (eof) ->
    stats = stats.sort()
    matches = matches.sort()
    eof = eof.sort()
    t.same stats, matches
    t.same eof, matches
    cache = Object.keys(@statCache)
    t.same cache.map((f) ->
      path.relative(__dirname, f).replace /\\/g, "/"
    ).sort(), matches
    cache.forEach ((c) ->
      t.equal typeof @statCache[c], "object"
      return
    ), this
    t.end()
    return

  return

