t = require("tap")
origCwd = process.cwd()
process.chdir __dirname
glob = require("../")
path = require("path")
t.test ".", (t) ->
  glob "/b*/**",
    globDebug: true
    root: "."
  , (er, matches) ->
    t.ifError er
    t.like matches, []
    t.end()
    return

  return

t.test "a", (t) ->
  console.error "root=" + path.resolve("a")
  glob "/b*/**",
    globDebug: true
    root: path.resolve("a")
  , (er, matches) ->
    t.ifError er
    wanted = [
      "/b"
      "/b/c"
      "/b/c/d"
      "/bc"
      "/bc/e"
      "/bc/e/f"
    ].map((m) ->
      path.join(path.resolve("a"), m).replace /\\/g, "/"
    )
    t.like matches, wanted
    t.end()
    return

  return

t.test "root=a, cwd=a/b", (t) ->
  glob "/b*/**",
    globDebug: true
    root: "a"
    cwd: path.resolve("a/b")
  , (er, matches) ->
    t.ifError er
    t.like matches, [
      "/b"
      "/b/c"
      "/b/c/d"
      "/bc"
      "/bc/e"
      "/bc/e/f"
    ].map((m) ->
      path.join(path.resolve("a"), m).replace /\\/g, "/"
    )
    t.end()
    return

  return

t.test "cd -", (t) ->
  process.chdir origCwd
  t.end()
  return

