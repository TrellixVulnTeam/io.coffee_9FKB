tap = require("tap")
origCwd = process.cwd()
process.chdir __dirname
tap.test "changing cwd and searching for **/d", (t) ->
  glob = require("../")
  path = require("path")
  t.test ".", (t) ->
    glob "**/d", (er, matches) ->
      t.ifError er
      t.like matches, [
        "a/b/c/d"
        "a/c/d"
      ]
      t.end()
      return

    return

  t.test "a", (t) ->
    glob "**/d",
      cwd: path.resolve("a")
    , (er, matches) ->
      t.ifError er
      t.like matches, [
        "b/c/d"
        "c/d"
      ]
      t.end()
      return

    return

  t.test "a/b", (t) ->
    glob "**/d",
      cwd: path.resolve("a/b")
    , (er, matches) ->
      t.ifError er
      t.like matches, ["c/d"]
      t.end()
      return

    return

  t.test "a/b/", (t) ->
    glob "**/d",
      cwd: path.resolve("a/b/")
    , (er, matches) ->
      t.ifError er
      t.like matches, ["c/d"]
      t.end()
      return

    return

  t.test ".", (t) ->
    glob "**/d",
      cwd: process.cwd()
    , (er, matches) ->
      t.ifError er
      t.like matches, [
        "a/b/c/d"
        "a/c/d"
      ]
      t.end()
      return

    return

  t.test "cd -", (t) ->
    process.chdir origCwd
    t.end()
    return

  t.end()
  return

