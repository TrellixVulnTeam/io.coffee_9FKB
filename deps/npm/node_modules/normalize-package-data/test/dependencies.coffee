tap = require("tap")
normalize = require("../lib/normalize")
warningMessages = require("../lib/warning_messages.json")
safeFormat = require("../lib/safe_format")
tap.test "warn if dependency contains anything else but a string", (t) ->
  warn = (w) ->
    warnings.push w
    return
  a = undefined
  warnings = []
  normalize a =
    dependencies:
      a: 123

    devDependencies:
      b: 456

    optionalDependencies:
      c: 789
  , warn
  wanted1 = safeFormat(warningMessages.nonStringDependency, "a", 123)
  wanted2 = safeFormat(warningMessages.nonStringDependency, "b", 456)
  wanted3 = safeFormat(warningMessages.nonStringDependency, "c", 789)
  t.ok ~warnings.indexOf(wanted1), wanted1
  t.ok ~warnings.indexOf(wanted2), wanted2
  t.ok ~warnings.indexOf(wanted3), wanted3
  t.end()
  return

tap.test "warn if bundleDependencies array contains anything else but strings", (t) ->
  warn = (w) ->
    warnings.push w
    return
  a = undefined
  warnings = []
  normalize a = bundleDependencies: [
    "abc"
    123
    {
      foo: "bar"
    }
  ], warn
  wanted1 = safeFormat(warningMessages.nonStringBundleDependency, 123)
  wanted2 = safeFormat(warningMessages.nonStringBundleDependency,
    foo: "bar"
  )
  wanted2 = safeFormat(warningMessages.nonDependencyBundleDependency, "abc")
  t.ok ~warnings.indexOf(wanted1), wanted1
  t.ok ~warnings.indexOf(wanted2), wanted2
  t.end()
  return

