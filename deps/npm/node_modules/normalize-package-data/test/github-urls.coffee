tap = require("tap")
normalize = require("../lib/normalize")
fs = require("fs")
async = require("async")
data = undefined
warn = undefined
tap.test "consistent normalization", (t) ->
  entries = [
    "read-package-json.json"
    "http-server.json"
    "movefile.json"
    "node-module_exist.json"
  ]
  verifyConsistency = (entryName, next) ->
    warn = (msg) ->

    
    # t.equal("",msg) // uncomment to have some kind of logging of warnings
    filename = __dirname + "/fixtures/" + entryName
    fs.readFile filename, (err, contents) ->
      return next(err)  if err
      data = JSON.parse(contents.toString())
      normalize data, warn
      t.same data.bugs.url, "https://gist.github.com/3135914"  if data.name is "node-module_exist"
      t.same data.bugs.url, "https://github.com/isaacs/read-package-json/issues"  if data.name is "read-package-json"
      t.same data.bugs.url, "https://github.com/nodejitsu/http-server/issues"  if data.name is "http-server"
      t.same data.bugs.url, "https://github.com/yazgazan/movefile/issues"  if data.name is "movefile"
      next null
      return

    return

  # fs.readFile
  # verifyConsistency
  async.forEach entries, verifyConsistency, (err) ->
    throw err  if err
    t.end()
    return

  return

# tap.test
