# convert git:// form url to github URL, e.g.,
# git://github.com/bcoe/foo.git
# https://github.com/bcoe/foo.
githubUrlFromGit = (url, opts) ->
  try
    m = re(opts).exec(url.replace(/\.git(#.*)?$/, ""))
    host = m[1]
    path = m[2]
    return "https://" + host + "/" + path
  return

# ignore

# generate the git:// parsing regex
# with options, e.g., the ability
# to specify multiple GHE domains.
re = (opts) ->
  opts = opts or {}
  
  # whitelist of URLs that should be treated as GitHub repos.
  baseUrls = [
    "gist.github.com"
    "github.com"
  ].concat(opts.extraBaseUrls or [])
  
  # build regex from whitelist.
  new RegExp(/^(?:https?:\/\/|git:\/\/|git\+ssh:\/\/|git\+https:\/\/)?(?:[^@]+@)?/.source + "(" + baseUrls.join("|") + ")" + /[:\/]([^\/]+\/[^\/]+?|[0-9]+)$/.source)
githubUrlFromGit.re = re()
module.exports = githubUrlFromGit
