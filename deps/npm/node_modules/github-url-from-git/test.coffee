parse = require("./")
assert = require("better-assert")
describe "parse(url)", ->
  it "should support git://*", ->
    url = "git://github.com/jamesor/mongoose-versioner"
    parse(url).should.equal "https://github.com/jamesor/mongoose-versioner"
    return

  it "should support git://*.git", ->
    url = "git://github.com/treygriffith/cellar.git"
    parse(url).should.equal "https://github.com/treygriffith/cellar"
    return

  it "should support https://*", ->
    url = "https://github.com/Empeeric/i18n-node"
    parse(url).should.equal "https://github.com/Empeeric/i18n-node"
    return

  it "should support https://*.git", ->
    url = "https://jpillora@github.com/banchee/tranquil.git"
    parse(url).should.equal "https://github.com/banchee/tranquil"
    return

  it "should return undefined on failure", ->
    url = "git://github.com/justgord/.git"
    assert null is parse(url)
    return

  it "should parse git@github.com:bcoe/thumbd.git", ->
    url = "git@github.com:bcoe/thumbd.git"
    parse(url).should.eql "https://github.com/bcoe/thumbd"
    return

  it "should parse git@github.com:bcoe/thumbd.git#2.7.0", ->
    url = "git@github.com:bcoe/thumbd.git#2.7.0"
    parse(url).should.eql "https://github.com/bcoe/thumbd"
    return

  it "should parse git+https://github.com/bcoe/thumbd.git", ->
    url = "git+https://github.com/bcoe/thumbd.git"
    parse(url).should.eql "https://github.com/bcoe/thumbd"
    return

  it "should parse git+ssh://github.com/bcoe/thumbd.git", ->
    url = "git+ssh://github.com/bcoe/thumbd.git"
    parse(url).should.eql "https://github.com/bcoe/thumbd"
    return

  it "should parse https://EastCloud@github.com/EastCloud/node-websockets.git", ->
    url = "https://EastCloud@github.com/EastCloud/node-websockets.git"
    parse(url).should.eql "https://github.com/EastCloud/node-websockets"
    return

  
  # gist urls.
  it "should parse git@gist urls", ->
    url = "git@gist.github.com:3135914.git"
    parse(url).should.equal "https://gist.github.com/3135914"
    return

  it "should parse https://gist urls", ->
    url = "https://gist.github.com/3135914.git"
    parse(url).should.equal "https://gist.github.com/3135914"
    return

  
  # Handle arbitrary GitHub Enterprise domains.
  it "should parse parse extra GHE urls provided", ->
    url = "git://github.example.com/treygriffith/cellar.git"
    parse(url,
      extraBaseUrls: ["github.example.com"]
    ).should.equal "https://github.example.com/treygriffith/cellar"
    return

  it "should parse GHE urls with multiple subdomains", ->
    url = "git://github.internal.example.com/treygriffith/cellar.git"
    parse(url,
      extraBaseUrls: ["github.internal.example.com"]
    ).should.equal "https://github.internal.example.com/treygriffith/cellar"
    return

  return

describe "re", ->
  it "should expose GitHub url parsing regex", ->
    parse.re.source.should.equal /^(?:https?:\/\/|git:\/\/|git\+ssh:\/\/|git\+https:\/\/)?(?:[^@]+@)?(gist.github.com|github.com)[:\/]([^\/]+\/[^\/]+?|[0-9]+)$/.source
    return

  return

