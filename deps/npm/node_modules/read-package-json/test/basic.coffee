# vim: set softtabstop=16 shiftwidth=16:
basic_ = (t, data) ->
  t.ok data
  t.equal data.version, package_.version
  t.equal data._id, data.name + "@" + data.version
  t.equal data.name, package_.name
  t.type data.author, "object"
  t.equal data.readme, readme
  t.deepEqual data.scripts, package_.scripts
  t.equal data.main, package_.main
  t.equal data.readmeFilename, "README.md"
  t.similar data.gitHead, /^[a-f0-9]{40}$/  if isGit
  
  # optional deps are folded in.
  t.deepEqual data.optionalDependencies, package_.optionalDependencies
  t.has data.dependencies, package_.optionalDependencies
  t.has data.dependencies, package_.dependencies
  t.deepEqual data.devDependencies, package_.devDependencies
  t.end()
  return
tap = require("tap")
readJson = require("../")
path = require("path")
fs = require("fs")
readme = fs.readFileSync(path.resolve(__dirname, "../README.md"), "utf8")
package_ = require("../package.json")
isGit = undefined
try
  fs.readFileSync path.resolve(__dirname, "../.git/HEAD")
  isGit = true
catch e
  isGit = false
console.error "basic test"
tap.test "basic test", (t) ->
  p = path.resolve(__dirname, "../package.json")
  readJson p, (er, data) ->
    throw er  if er
    basic_ t, data
    return

  return

