require "../index"
assert = require("assert")
fork = require("child_process").fork
cp = fork("worker-fork")
gotMessage = false
gotExit = false
gotClose = false
cp.on "message", (msg) ->
  assert.strictEqual msg, "hello"
  assert not gotMessage
  assert not gotClose
  gotMessage = true
  return

cp.on "exit", (code, signal) ->
  assert.strictEqual code, 0
  assert not signal
  assert not gotExit
  assert not gotClose
  gotExit = true
  return

cp.on "close", (code, signal) ->
  assert.strictEqual code, 0
  assert not signal
  assert gotExit
  assert gotMessage
  assert not gotClose
  gotClose = true
  return

process.on "exit", ->
  assert gotMessage
  assert gotExit
  assert gotClose
  return

