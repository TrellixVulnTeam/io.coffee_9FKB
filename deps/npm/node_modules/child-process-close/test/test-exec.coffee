require "../index"
assert = require("assert")
exec = require("child_process").exec
cp = exec("echo hello", (err) ->
  assert not err
  return
)
stdoutData = ""
stdoutEnd = false
gotExit = false
gotClose = false
cp.stdout.setEncoding "ascii"
cp.stdout.on "data", (data) ->
  assert not stdoutEnd
  stdoutData += data
  return

cp.stdout.on "end", ->
  assert not stdoutEnd
  assert /^hello/.test(stdoutData)
  stdoutEnd = true
  return

cp.on "exit", (code, signal) ->
  assert.strictEqual code, 0
  assert not signal
  assert not gotExit
  assert not gotClose
  gotExit = true
  return

cp.on "close", (code, signal) ->
  assert.strictEqual code, 0
  assert not signal
  assert gotExit
  assert stdoutEnd
  assert not gotClose
  gotClose = true
  return

process.on "exit", ->
  assert stdoutEnd
  assert gotExit
  assert gotClose
  return

