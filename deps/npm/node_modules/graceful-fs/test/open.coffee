test = require("tap").test
fs = require("../graceful-fs.js")
test "graceful fs is monkeypatched fs", (t) ->
  t.equal fs, require("../fs.js")
  t.end()
  return

test "open an existing file works", (t) ->
  fd = fs.openSync(__filename, "r")
  fs.closeSync fd
  fs.open __filename, "r", (er, fd) ->
    throw er  if er
    fs.close fd, (er) ->
      throw er  if er
      t.pass "works"
      t.end()
      return

    return

  return

test "open a non-existing file throws", (t) ->
  er = undefined
  try
    fd = fs.openSync("this file does not exist", "r")
  catch x
    er = x
  t.ok er, "should throw"
  t.notOk fd, "should not get an fd"
  t.equal er.code, "ENOENT"
  fs.open "neither does this file", "r", (er, fd) ->
    t.ok er, "should throw"
    t.notOk fd, "should not get an fd"
    t.equal er.code, "ENOENT"
    t.end()
    return

  return

