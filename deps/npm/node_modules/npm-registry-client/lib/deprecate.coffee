deprecate = (uri, ver, message, cb) ->
  c = @conf.getCredentialsByURI(uri)
  return cb(new Error("Must be logged in to deprecate a package"))  unless c.token or c.auth
  return cb(new Error("invalid version range: " + ver))  if semver.validRange(ver) is null
  
  # filter all the versions that match
  
  # now update the doc on the registry
  @get uri + "?write=true", null, ((er, data) ->
    return cb(er)  if er
    Object.keys(data.versions).filter((v) ->
      semver.satisfies v, ver
    ).forEach (v) ->
      data.versions[v].deprecated = message
      return

    @request "PUT", url.resolve(uri, data._id),
      body: data
    , cb
    return
  ).bind(this)
  return
module.exports = deprecate
url = require("url")
semver = require("semver")
