upload = (uri, file, etag, nofollow, cb) ->
  if typeof nofollow is "function"
    cb = nofollow
    nofollow = false
  if typeof etag is "function"
    cb = etag
    etag = null
  if file instanceof Stream
    return @request("PUT", uri,
      body: file
      etag: etag
      follow: not nofollow
    , cb)
  fs.stat file, ((er, stat) ->
    return cb(er)  if er
    s = fs.createReadStream(file)
    s.size = stat.size
    s.on "error", cb
    @request "PUT", uri,
      body: s
      etag: etag
      follow: not nofollow
    , cb
    return
  ).bind(this)
  return
module.exports = upload
fs = require("fs")
Stream = require("stream").Stream
