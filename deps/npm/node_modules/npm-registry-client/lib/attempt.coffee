attempt = (cb) ->
  
  # Tuned to spread 3 attempts over about a minute.
  # See formula at <https://github.com/tim-kos/node-retry>.
  operation = retry.operation(
    retries: @conf.get("fetch-retries") or 2
    factor: @conf.get("fetch-retry-factor")
    minTimeout: @conf.get("fetch-retry-mintimeout") or 10000
    maxTimeout: @conf.get("fetch-retry-maxtimeout") or 60000
  )
  client = this
  operation.attempt (currentAttempt) ->
    client.log.info "attempt", "registry request try #" + currentAttempt + " at " + (new Date()).toLocaleTimeString()
    cb operation
    return

  return
retry = require("retry")
module.exports = attempt
