tap = require("tap")
server = require("./lib/server.js")
common = require("./lib/common.js")
client = common.freshClient()
us = require("./fixtures/underscore/1.3.3/cache.json")
usroot = require("./fixtures/underscore/cache.json")
tap.test "basic request", (t) ->
  server.expect "/underscore/1.3.3", (req, res) ->
    res.json us
    return

  server.expect "/underscore", (req, res) ->
    res.json usroot
    return

  server.expect "/@bigco%2funderscore", (req, res) ->
    res.json usroot
    return

  t.plan 3
  client.get "http://localhost:1337/underscore/1.3.3", null, (er, data) ->
    t.deepEqual data, us
    return

  client.get "http://localhost:1337/underscore", null, (er, data) ->
    t.deepEqual data, usroot
    return

  client.get "http://localhost:1337/@bigco%2funderscore", null, (er, data) ->
    t.deepEqual data, usroot
    return

  return

