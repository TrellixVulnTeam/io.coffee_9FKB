OneA = ->
  Readable.call this
  @push "A"
  @push null
  return
tap = require("tap")
Readable = require("stream").Readable
inherits = require("util").inherits
common = require("./lib/common.js")
server = require("./lib/server.js")
cache = require("./fixtures/underscore/cache.json")
nerfed = "//localhost:" + server.port + "/:"
configuration = {}
configuration[nerfed + "_authToken"] = "of-glad-tidings"
client = common.freshClient(configuration)
inherits OneA, Readable
tap.test "uploading a tarball", (t) ->
  server.expect "PUT", "/underscore", (req, res) ->
    t.equal req.method, "PUT"
    res.json cache
    return

  client.upload "http://localhost:1337/underscore", new OneA(), "daedabeefa", true, (error) ->
    t.ifError error, "no errors"
    t.end()
    return

  return

