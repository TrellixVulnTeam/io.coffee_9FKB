tap = require("tap")
server = require("./lib/server.js")
common = require("./lib/common.js")
nerfed = "//localhost:" + server.port + "/:"
configuration = {}
configuration[nerfed + "_authToken"] = "not-bad-meaning-bad-but-bad-meaning-wombat"
client = common.freshClient(configuration)
WHOIAM = "wombat"
tap.test "whoami", (t) ->
  server.expect "GET", "/whoami", (req, res) ->
    t.equal req.method, "GET"
    
    # only available for token-based auth for now
    t.equal req.headers.authorization, "Bearer not-bad-meaning-bad-but-bad-meaning-wombat"
    res.json username: WHOIAM
    return

  client.whoami common.registry, (error, wombat) ->
    t.ifError error, "no errors"
    t.equal wombat, WHOIAM, "im a wombat"
    t.end()
    return

  return

