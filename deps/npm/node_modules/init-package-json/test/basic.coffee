tap = require("tap")
init = require("../")
rimraf = require("rimraf")
tap.test "the basics", (t) ->
  i = __dirname + "/basic.input"
  dir = __dirname
  init dir, i,
    foo: "bar"
  , (er, data) ->
    throw er  if er
    expect =
      name: "the-name"
      version: "1.2.5"
      description: "description"
      author: "me <em@i.l> (http://url)"
      scripts:
        test: "make test"

      main: "main.js"
      config:
        foo: "bar"

      package: {}

    t.same data, expect
    t.end()
    return

  setTimeout (->
    process.stdin.emit "data", "the-name\n"
    return
  ), 50
  setTimeout (->
    process.stdin.emit "data", "description\n"
    return
  ), 100
  setTimeout (->
    process.stdin.emit "data", "yes\n"
    return
  ), 150
  return

tap.test "teardown", (t) ->
  rimraf __dirname + "/package.json", t.end.bind(t)
  return

