# ignore most things
IgnoreFile = require("../")

# set the ignores just for this test
c = require("./common.js")
c.ignores
  ".ignore": [
    "*"
    "a"
    "c"
    "!a/b/c/.abc"
    "!/c/b/a/cba"
  ]
  "a/.ignore": [ # unignore everything
    "!*"
    ".ignore"
  ]
  "a/a/.ignore": ["*"] # re-ignore everything
  "a/b/.ignore": [ # original unignore
    "*"
    "!/c/.abc"
  ]
  "a/c/.ignore": ["*"] # ignore everything again
  "c/b/a/.ignore": [
    "!cba"
    "!.cba"
    "!/a{bc,cb}"
  ]


# the only files we expect to see
expected = [
  "/a"
  "/a/a"
  "/a/b"
  "/a/b/c"
  "/a/b/c/.abc"
  "/a/c"
  "/c"
  "/c/b"
  "/c/b/a"
  "/c/b/a/cba"
  "/c/b/a/.cba"
  "/c/b/a/abc"
  "/c/b/a/acb"
]
require("tap").test "basic ignore rules", (t) ->
  t.pass "start"
  IgnoreFile(
    path: __dirname + "/fixtures"
    ignoreFiles: [".ignore"]
  ).on("child", (e) ->
    p = e.path.substr(e.root.path.length)
    i = expected.indexOf(p)
    if i is -1
      console.log "not ok " + p
      t.fail "unexpected file found",
        found: p

    else
      t.pass p
      expected.splice i, 1
    return
  ).on "close", ->
    t.deepEqual expected, [], "all expected files should be seen"
    t.end()
    return

  return

