test = require("tap").test
once = require("../once.js")
test "once", (t) ->
  fn = (g) ->
    t.equal f, 0
    f++
    f + g + this
  f = 0
  fn.ownProperty = {}
  foo = once(fn)
  t.equal fn.ownProperty, foo.ownProperty
  t.notOk foo.called
  i = 0

  while i < 1e3
    t.same f, (if i is 0 then 0 else 1)
    g = foo.call(1, 1)
    t.ok foo.called
    t.same g, 3
    t.same f, 1
    i++
  t.end()
  return

