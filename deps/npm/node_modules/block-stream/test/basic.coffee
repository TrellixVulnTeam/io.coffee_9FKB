tap = require("tap")
BlockStream = require("../block-stream.js")
tap.test "basic test", (t) ->
  b = new BlockStream(16)
  fs = require("fs")
  fstr = fs.createReadStream(__filename,
    encoding: "utf8"
  )
  fstr.pipe b
  stat = undefined
  t.doesNotThrow (->
    stat = fs.statSync(__filename)
    return
  ), "stat should not throw"
  totalBytes = 0
  b.on "data", (c) ->
    t.equal c.length, 16, "chunks should be 16 bytes long"
    t.type c, Buffer, "chunks should be buffer objects"
    totalBytes += c.length
    return

  b.on "end", ->
    expectedBytes = stat.size + (16 - stat.size % 16)
    t.equal totalBytes, expectedBytes, "Should be multiple of 16"
    t.end()
    return

  return

