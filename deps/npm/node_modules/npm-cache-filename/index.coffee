cf = (root, u) ->
  return cf.bind(null, root)  unless u
  u = url.parse(u)
  h = u.host.replace(/:/g, "_")
  
  # Strip off any /-rev/... or ?rev=... bits
  revre = /(\?rev=|\?.*?&rev=|\/-rev\/).*$/
  parts = u.path.replace(revre, "").split("/").slice(1)
  p = [
    root
    h
  ].concat(parts.map((part) ->
    return encodeURIComponent(part).replace(/%/g, "_")
    return
  ))
  return path.join.apply(path, p)
  return
url = require("url")
path = require("path")
module.exports = cf
